<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Kakao Map Route</title>

  <!-- ðŸ”‘ ì¹´ì¹´ì˜¤ ì§€ë„ JS í‚¤ (libraries=services í•„ìˆ˜) -->
  <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=18daa2632f3904b11cea2f0610fd6198&libraries=services"></script>

  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #container { display: flex; height: 100vh; }
    #sidebar {
      width: 320px;
      padding: 16px;
      border-right: 1px solid #ddd;
      background: #fafafa;
    }
    #map { flex: 1; }
    input { width: 100%; padding: 8px; margin-bottom: 8px; }
    button { width: 100%; padding: 10px; }
    .result {
      margin-top: 12px;
      padding: 10px;
      background: #fff;
      border: 1px solid #ddd;
    }
  </style>
</head>
<body>

<div id="container">
  <div id="sidebar">
    <h2>ê²½ë¡œ ê³„ì‚°</h2>

    <input id="startInput" placeholder="ì¶œë°œì§€ (ì˜ˆ: ëŒ€êµ¬ì‹œì²­)">
    <input id="endInput" placeholder="ë„ì°©ì§€ (ì˜ˆ: ë™ëŒ€êµ¬ì—­)">
    <button onclick="searchPlaces()">ê²½ë¡œ ê³„ì‚°</button>

    <div class="result">
      <div>ê±°ë¦¬: <span id="distance">-</span></div>
      <div>ì‹œê°„: <span id="time">-</span></div>
    </div>
  </div>

  <div id="map"></div>
</div>

<script>
  /* ì§€ë„ ìƒì„± */
  const map = new kakao.maps.Map(document.getElementById("map"), {
    center: new kakao.maps.LatLng(35.8714, 128.6014),
    level: 5
  });

  /* ìž¥ì†Œ ê²€ìƒ‰ ê°ì²´ */
  const ps = new kakao.maps.services.Places();

  let startMarker = null;
  let endMarker = null;
  let startPoint = null;
  let endPoint = null;

  /* ì¶œë°œì§€ / ë„ì°©ì§€ ê²€ìƒ‰ */
  function searchPlaces() {
    const startKeyword = document.getElementById("startInput").value;
    const endKeyword = document.getElementById("endInput").value;

    if (!startKeyword || !endKeyword) {
      alert("ì¶œë°œì§€ì™€ ë„ì°©ì§€ë¥¼ ìž…ë ¥í•˜ì„¸ìš”");
      return;
    }

    ps.keywordSearch(startKeyword, (data, status) => {
      if (status !== kakao.maps.services.Status.OK) {
        alert("ì¶œë°œì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
        return;
      }

      startPoint = data[0];
      const startPos = new kakao.maps.LatLng(startPoint.y, startPoint.x);

      if (startMarker) startMarker.setMap(null);
      startMarker = new kakao.maps.Marker({ position: startPos, map });

      ps.keywordSearch(endKeyword, (data2, status2) => {
        if (status2 !== kakao.maps.services.Status.OK) {
          alert("ë„ì°©ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤");
          return;
        }

        endPoint = data2[0];
        const endPos = new kakao.maps.LatLng(endPoint.y, endPoint.x);

        if (endMarker) endMarker.setMap(null);
        endMarker = new kakao.maps.Marker({ position: endPos, map });

        map.setBounds(new kakao.maps.LatLngBounds(startPos, endPos));

        requestRoute();
      });
    });
  }

  /* ðŸš— ì„œë²„(Spring) REST APIë¡œ ì‹¤ì œ ê²½ë¡œ ê±°ë¦¬/ì‹œê°„ ìš”ì²­ */
  function requestRoute() {
    fetch(`/api/route?startLat=${startPoint.y}&startLng=${startPoint.x}&endLat=${endPoint.y}&endLng=${endPoint.x}`)
            .then(res => res.json())
            .then(data => {
              const summary = data.routes[0].summary;

              document.getElementById("distance").innerText =
                      (summary.distance / 1000).toFixed(2) + " km";

              document.getElementById("time").innerText =
                      Math.round(summary.duration / 60) + " ë¶„";
            })
            .catch(() => alert("ê²½ë¡œ ê³„ì‚° ì‹¤íŒ¨"));
  }
</script>

</body>
</html>
